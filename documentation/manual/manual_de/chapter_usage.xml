<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
    "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<chapter id="usage">
	<title>Anwendung</title>
	
	<sect1 id="usage.nested_navigation">
		<title>Verschachtelte Navigationen</title>

		<sect2 id="usage.nested_navigation.introduction">
			<title>Einführung</title>
		
			<para>
				Ein übliches Szenario in der Erstellung von Vorlagen ist
				die Erstellung und Anzeige von verschachtelten Navigationen.
				Hier wird erklärt, wie eine mehrstufige, verschachtelte
				Navigation erstellt wird, deren Menüpunkte auch korrespondierend
				zu den Unterpunkten ein- und aufklappen und die komfortabel
				in die Seitenvorlage inkludiert werden.
			</para>
		
		<note>
			<para>Um eine verschachtelte Navigation zu erstellen/anzeigen zu lassen,
				werden ineinander verschachtelte Smarty-Schleifen benötigt ({foreach}{/foreach}).
				Damit unsere Vorlagen nicht unnötig kompliziert und groß werden, lagern
				wir den Code zur Navigationserstellung in zwei eigenen Vorlagentypen aus,
				die wir dann in jeder beliebigen Seitenvorlage inkludieren können, in der
			 	die Navigation angezeigt werden soll.</para>
		</note>
		</sect2>
				
		
		<sect2 id="usage.nested_navigation.setup">
			<title>Einrichtung</title>
			
			<para>Gehen Sie zur Rubrik <guimenu>Vorlagen</guimenu> in die
			 Unterrubrik <guisubmenu>Vorlagentypen</guisubmenu> und klicken
			 Sie auf <guibutton>Neu anlegen</guibutton> um einen neuen Eintrag
			 anzulegen.</para>

			<para>Legen Sie <emphasis>jeweils</emphasis> einen Vorlagentyp
			 mit Namen <userinput>custom_navigation_embed</userinput> und
			 <userinput>custom_navigation_generator</userinput>.</para>

			<para>Wechseln Sie nun zur Unterrubrik <guisubmenu>Seitenvorlagen</guisubmenu>
			. Hier legen wir für unsere zwei neuen gerade angelegten Vorlagentypen
			 <emphasis>jeweils</emphasis> 1 Seitenvorlage an. Wir beginnen mit der
			 Seitenvorlage für den Vorlagentyp <userinput>custom_navigation_embed</userinput>.</para>

			<para>Klicken Sie auf <guibutton>Neu anlegen</guibutton> um einen
			 neue Seitenvorlage anzulegen. Wählen Sie im Feld <guilabel>Typ</guilabel>
			 unseren neuen Vorlagentyp aus (hier: <userinput>custom_navigation_embed</userinput>).
			Vergeben Sie einen beliebigen Namen für die Seitenvorlage.</para>

<para>Kopieren Sie folgenden Quelltext und fügen diesen im Feld <guilabel>Inhalt</guilabel> ein.</para>

		<programlisting language="smarty"><![CDATA[
{select_named ns="Content" class="Page" method="selectPages" var="pages" navigation="1"}
{select_simple ns="Content" class="Page" method="selectPath" var="path" target=$page.id}

{include file="wcom:custom_navigation_generator.`$page.id`" pages=$pages level=1 parent=0}

]]></programlisting>

		<note>
			<para>Hinweis: Wir gehen davon aus, das eine Navigation mit der
			 ID <userinput>1</userinput> existiert. Passen Sie den Parameter
			 <filename>navigation</filename> ggf. an.
			</para>
		</note>

		<para>Selektieren Sie die <guilabel>Vorlagengruppen</guilabel>, die den
		 inhaltlichen Seiten zugeordnet sind, in denen die Navigation später
		 angezeigt werden soll. Speichern Sie die Seitenvorlage.</para>

		<para>Legen Sie nun in analoger Art und Weise die Seitenvorlage für
			 den Vorlagentyp <userinput>custom_navigation_generator</userinput>
			 an. Klicken Sie auf <guibutton>Neu anlegen</guibutton> um einen
			 neue Seitenvorlage anzulegen Wählen Sie im Feld <guilabel>Typ</guilabel>
			 unseren zweiten, neuen Vorlagentyp <emphasis>custom_navigation_generator</emphasis> aus.
			 Vergeben Sie wiederum einen beliebigen Namen für die Seitenvorlage.</para>

		<para>Kopieren Sie folgenden Quelltext und fügen diesen
			im Feld <guilabel>Inhalt</guilabel> ein.</para>

		<programlisting language="smarty"><![CDATA[
<ul class="nav_{$level}">
{foreach from=$pages item=_page}
    {if $_page.level == $level && $_page.parent == $parent}
        {* find out if navigation item is in path *}
        {assign var="__in_path" value="false"}
        {foreach from=$path item=_path}
            {if $_page.id == $_path.id}
                {assign var="__in_path" value="true"}
            {/if}
        {/foreach}
            
        <li{if $page.id == $_page.id} class="on"{/if}>
            {if $page.id == $_page.id}
                <span>{$_page.name}</span>
                        {else}
                <a href="{get_url page_id=$_page.id action="Index"}">{$_page.name}</a>
            {/if}    
            {if ($_page.rgt - $_page.lft) > 1 && $__in_path == 'true'}
                {include file="wcom:custom_navigation_generator.`$page.id`" pages=$pages
                    level=$_page.level|increment parent=$_page.id}
            {/if}
        </li>
    {/if}
{/foreach}
</ul>
]]></programlisting>

			<para>Der Ausgabe-Quelltext wird bei einer zweistufigen Navigation
	 			beispielhaft wie folgt aussehen:</para>

		<programlisting language="smarty"><![CDATA[
<ul class="nav_1">
    <li><a href="datei.suffix">Seite</a></li>
    <li><a href="datei.suffix">Seite</a></li>
    <li class="on"><span>Aktive Seite</span>
        <ul class="nav_2">
            <li><a href="datei.suffix">Seite</a></li>
            <li><a href="datei.suffix">Seite</a></li>
        </ul>            
    </li>
    <li><a href="datei.suffix">Seite</a></li>
</ul>
]]></programlisting>

			<para>Selektieren Sie die <guilabel>Vorlagengruppen</guilabel>,
			die den inhaltlichen Seiten zugeordnet sind, in denen die Navigation
			später angezeigt werden soll. Speichern Sie die Seitenvorlage.</para>

			<para>Nun sind wir fast fertig. Was fehlt ist die Einbindung der Navigation
			 in die Seitenvorlagen, in denen wir die Navigation einbinden wollen.</para>

			<para>Wählen Sie die gewünschte Seitenvorlage aus, in der die Navigation
			 eingefügt werden soll und gehen über das <guibutton>Bearbeiten-Symbol</guibutton>
			 zur inhaltlichen Ansicht. Fügen Sie an der Stelle, an der die Navigation plaziert
			 werden soll, folgenden Quelltext ein:</para>

		<programlisting language="smarty"><![CDATA[
{include file="wcom:custom_navigation_embed.`$page.id`"}
]]></programlisting>

			<para>Speichern Sie die Seitenvorlage.</para>
			
			<note>
				<para>Um die Navigation zu stylen, können die in dem Beispiel deklarierten
					Klassen verwendet werden. Wenn Sie andere Klassen preferieren, editieren
					sie bitte die Vorlage <userinput>custom_navigation_generator</userinput>.
				</para>
			</note>
		</sect2>
	</sect1>
	
	<sect1 id="usage.google_sitemaps">
		<title>Google Sitemaps</title>
		
		<sect2 id="usage.google_sitemaps.introduction">
			<title>Einführung</title>
		
			<para>
				Google Sitemaps sind XML Dateien, in denen die Seitenpfade und die 
				dazugehörigen Metadaten ihrer Webseite  statisch hinterlegt werden. 
				Diese Datei(en) (<filename>sitemap.xml</filename>, 
				<filename>sitemap.xml.gz</filename>(gunzip komprimiert)), deren Schema dem
				Standardprotokoll entspricht (<ulink type="external" url="http://sitemaps.org/protocol.php"/>),
				erleichtern den Webcrawlern von Google den Informationszugang zu ihren Seiten und sind
				 ein wertvolles Werkzeug um die 
				<ulink type="external" url="http://de.wikipedia.org/wiki/Suchmaschinenoptimierung">SEO</ulink>
				auszubauen. Die Datei(en) müssen sie manuell ihrem Google-Konto hinzugefügen.
			</para>

			<note>
				<para>Die Nutzung dieses Features setzt das Vorhanden sein eines
					<ulink type="external" url="http://www.google.com/support/accounts/">Google-Konto</ulink>
					voraus.
				</para>
			</note>
		</sect2>
			
		<sect2 id="usage.google_sitemaps.setup">
			<title>Einrichtung</title>
						
			<figure id="usage.google_sitemaps.edit_sitemaps">
				<title>Seiten editieren: Sitemap Metadaten</title>
				<graphic fileref="images/usage/sitemaps/edit_sitemaps.png"/>
			</figure>
			
			<variablelist>
				<varlistentry>
					<term><guilabel>Sitemap Änderungshäufigkeit</guilabel></term>
					<listitem>
						<para>
							Wählen sie ein Zeitinterval aus, der Google sagt, wie
							häufig aktualisierte Inhalte erwartet werden können.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term><guilabel>Sitemap Priorität</guilabel></term>
					<listitem>
						<para>
							Wert, der Google die interne Gewichtung mitteilt. 0.5
							ist hier der Mittelwert.
							<note>
								<para>
									Bitte beachten sie, das dieser Wert keinen Einfluß auf das Ranking
									der betreffenden Seite hat, sondern Google nur mitteilt, welche
									Seiten der Crawler vorrangig berücksichtigen soll.
								</para>
							</note>
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			
		</sect2>
		
		<sect2 id="usage.google_sitemaps.generate">
			<title>Sitemaps erstellen</title>
		
			<para>
				Sitemaps werden im Menüpunkt <guimenu>Einstellungen</guimenu> unter
				<guisubmenu>Sitemaps</guisubmenu> angelegt.
			</para>
			
			<figure id="usage.google_sitemaps.generate_sitemaps">
				<title>Sitemaps erstellen</title>
				<graphic fileref="images/usage/sitemaps/generate_sitemaps.png"/>
			</figure>
			
			<variablelist>
				<varlistentry>
					<term><guilabel>Komprimieren</guilabel></term>
					<listitem>
						<para>
							Ist diese Checkbox angeklickt, wird zusätzlich zur XML Sitemap
							(<filename>sitemap.xml</filename>) eine gunzip komprimierte XML Sitemap-Datei
							erstellt (<filename>sitemap.xml.gz</filename>).
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			
			<para>
				Klicken auf <guibutton>Speichern</guibutton>, wird die Sitemap-Datei
				automatisch aus der Pfadstruktur Ihrer Installation erstellt.
				Diese beinhaltet alle Seiten, die ihrer Domain zugeordnet und nicht
				im <emphasis>Entwurf-Modus</emphasis> gespeichert oder
				als <emphasis>Geschützt</emphasis> ausgezeichnet sind 
				(s. <xref linkend="contents.pages.manage.add_page"/>).
			</para>
			
			<para>
				Ablageort der generierten Sitemap(s) ist der Ordner <filename>/tmp/sitemaps</filename>. 
			</para>
			
			<para>
				Da die Google-Richtlinien dies dringend empfehlen, verschieben sie die Datei(en)
				anschließend bitte auf ihrem Server auf die <emphasis role="strong">oberste Ebene</emphasis>
				ihrer Installation (Webroot).
			</para>
			
			<example id="usage.google_sitemaps.example.path">
				<title>Pfad(e) Sitemap Datei(en)</title>
<programlisting><![CDATA[
http://ihre-domain.tld/sitemap.xml
http://ihre-domain.tld/sitemap.xml.gz
]]></programlisting>			
			</example>
			
			<para>
				Anschließend melden sie sich (ggf. in einem neuen Browserfenster)
				an ihren Google-Konto an und fügen die Datei(en) ihrem Konto hinzu.
			</para>
			
			<tip>
				<para>
					Wenn sie seit der Erstellung einer Sitemap Ihrer Installation neue Seiten
					hinzugefügt haben, sollten sie jeweils daran denken eine neue Sitemap zu generieren,
					damit die neuen URLs berücksichtigt werden. Ersetzten sie die veraltete Sitemap
					im obersten Verzeichnis durch die neu generierte. Ein erneutes Anmeldung der 
					Sitemap in ihrem Google-Konto ist nicht ausdrücklich notwendig, schadet aber
					auch nicht ;-) Weitere Information zu Sitemaps finden sie unter
				</para>
			</tip>
			
		</sect2>
	</sect1>
	
	<!-- <sect1 id="usage.multi_language_websites">
		<title>Mehrsprachige Websites</title>
		
		<para/>
	</sect1> -->
	
	<sect1 id="usage.protected_pages">
		<title>Geschützte Seiten (Passwortschutz)</title>

		<sect2 id="usage.protected_pages.introduction">
			<title>Einführung</title>
		
			<para>
				Welcompose unterstützt den Passwortschutz von einzelnen Seiten.
				So kann den Mitgliedern einer oder mehreren Benutzergruppen der
				exklusive Zugriff auf die Inhalte einer oder mehrerer Seiten
				gewährt werden, sobald sich die Mitglieder der Benutzergruppen
				gegenüber dem System authentifiziert haben.
			</para>
		</sect2>
		
		<sect2 id="usage.protected_pages.setup">
			<title>Einrichtung</title>
		
			<para>
				Die Zugangskontrolle zu geschützten Seiten erfolgt mit Hilfe
				der Welcompose-Benutzergruppen. Um eine oder mehrere Seiten zu
				schützen, müssen Sie also zuerst einmal eine oder mehrere
				Benutzergruppen anlegen. Diesen werden später die Benutzer
				zugeordnet, die Zugriff auf die Seiten erhalten sollen.
			</para>
		
			<para>
				Um eine neue Benutzergruppe zu erstellen, wechseln Sie zum
				Bereich <guimenu>Benutzer</guimenu> und dort zum Unterpunkt 
				<guisubmenu>Benutzergruppen</guisubmenu>. Suchen Sie dort nach der
				Benutzergruppe WCOM_ANONYMOUS und klicken dort auf die 
				Schaltfläche <guibutton>Duplizieren</guibutton>. Ändern Sie nun
				den Namen der Benutzergruppe. Achten Sie dabei darauf, ein
				Prefix wie <userinput>CUSTOM_</userinput> zu verwenden, damit
				keine Kollisionen mit Welcompose-Benutzergruppen auftreten
				können. Als Beispiel soll der Name
				<userinput>CUSTOM_LOGIN_INTERN</userinput> verwendet werden.
				Geben Sie als Beschreibung einen Text ein, der erklärt, wozu
				diese Gruppe dient, beispielsweise <userinput>Passwortschutz
				für Seite Intern</userinput>. Lassen Sie die ausgewählten
				Benutzerrechte unberührt und klicken Sie dann auf
				<guibutton>Benutzergruppe duplizieren</guibutton>.
			</para>
		
			<figure id="usage.protected_pages.setup.add_user_group">
				<title>Benutzergruppe für Passwortschutz anlegen</title>
				<graphic fileref="images/usage/protected_pages/setup.add_user_group.png"/>
			</figure>
		
			<para>
				Wechseln Sie zum
				Bereich zum Unterpunkt 
				<guisubmenu>Benutzer</guisubmenu>.
				Ordnen Sie nun einen oder mehrere Benutzer der soeben
				angelegten Gruppe zu. Achten Sie dabei darauf, dem Benutzer
				keine Autoren-Rechte einzuräumen, da er sich sonst am
				Administrationsbereich anmelden kann.
			</para>
		
			<figure id="usage.protected_pages.setup.add_user">
				<title>Benutzer für geschützte Seite hinzufügen</title>
				<graphic fileref="images/usage/protected_pages/setup.add_user.png"/>
			</figure>
		
			<para>
				Legen Sie nun die neue Seite an (in unseren Beispiel mit Namen
				<userinput>Intern</userinput> respektive bearbeiten eine
				bestehende Seite, in dem Sie aud der Seitenübersicht im Bereich
				<guimenu>Inhalte</guimenu> in der jeweiligen Zeile auf <guibutton>
				Bearbeiten</guibutton> klicken und dann in der Subnavigation der
				Seite auf <guibutton>Metadaten</guibutton> klicken.
			</para>
		
			<para>
				Klicken Sie dort bei <emphasis>Geschützt</emphasis> die
				Checkbox an und wählen darunter die Benutzergruppen aus, die
				Zugang zu dieser Seite erhalten sollen. Wählen Sie auf jeden
				Fall die soeben angelegte Gruppe, also
				<guimenuitem>CUSTOM_LOGIN_INTERN</guimenuitem>, aus. Dazu
				können Sie die Standard-Gruppen für Autoren
				<guimenuitem>WCOM_ADMIN</guimenuitem> und
				<guimenuitem>WCOM_REGULAR</guimenuitem> auswählen. So erhalten
				alle Anwender, die Zugang zum Administrationsbereich haben,
				Zugang zur geschützten Seite.
			</para>
		
			<warning>
				<para>
					Wählen Sie keinesfalls 
					<guimenuitem>WCOM_ANONYMOUS</guimenuitem> als
					Benutzergruppe aus. Sonst erhalten alle Besucher Zugang
					zur geschützten Seite &ndash; ohne Passwort.
				</para>
			</warning>
		
			<figure id="usage.protected_pages.setup.protect_page">
				<title>Seite schützen</title>
				<graphic fileref="images/usage/protected_pages/setup.protect_page.png"/>
			</figure>
		
			<para>
				Rufen Sie nun über den öffentlichen Bereich die Seite auf, die
				geschützt werden soll, wird anstatt der regulären Seite eine
				Fehlermeldung angezeigt, wonach eine Vorlage vom Typ
				system_login benötigt wird. Diese zeigt das Login-Formular an,
				das die Benutzer verwenden müssen, um sich anzumelden.
			</para>
		
			<para>
				Um diese Vorlage anzulegen, gehen Sie zum Bereich
				<guimenu>Vorlagen</guimenu> und dort zum Unterpunkt 
				<guisubmenu>Seitenvorlagen</guisubmenu>. Legen Sie dort eine
				Vorlage vom Typ <userinput>system_login</userinput> an und weisen Sie
				 sie der Vorlagengruppe zu, der von der geschützten Seite verwendet
				wird. Fügen Sie an einem beliebigen Platz das Login-Formular
				ein (das optisch an die eigenen Bedürfnisse angepasst werden
				kann):
			</para>
		
			<programlisting><![CDATA[
{if !empty($form.errors)}
<ul>
{foreach from=$form.errors  key="field_name" item="error"}
    <li>{$error}</li>
{/foreach}
</ul>
{/if}

<p>{$form.requirednote}</p>

<form {$form.attributes}>
{$form.javascript}

<fieldset>
{$form.hidden}
<label for="email">{$form.email.label}</label>{$form.email.html}<br />
<label for="secret">{$form.secret.label}</label>{$form.secret.html}
</fieldset>

{$form.submit.html}
</form>
]]></programlisting>
			
			<figure id="usage.protected_pages.setup.create_login_template">
				<title>Login-Vorlage erstellen</title>
				<graphic fileref="images/usage/protected_pages/setup.create_login_template.png"/>
			</figure>
			
			<para>
				Sobald die Vorlage gespeichert wurde und Sie die geschützte
				Seite im öffentlichen Bereich aufrufen, sollte das
				Login-Formular erscheinen. Füllen Sie dieses mit Ihren
				Zugangsdaten aus (sofern Sie Mitglied einer Gruppe sind, die
				auf diese Seite zugreifen darf) und senden es ab. Sie sollten
				nun auf die eigentliche Seite weitergeleitet werden.
			</para>
		</sect2>
		
		<sect2 id="usage.protected_pages.limitations">
			<title>Einschränkungen</title>
			
			<para>
				Der Passwortschutz von Welcompose unterliegt einer Reihe von
				Einschränkungen:
			</para>
			
			<itemizedlist>
				<listitem>
					<para>
						Wenn eine Seite mit einem Passwortschutz versehen
						wird, wird nur diese eine Seite geschützt. Der
						Passwortschutz hat auf darunterliegende Seiten keine
						Auswirkung.
					</para>
				</listitem>
				<listitem>
					<para>
						Bein einer geschützten Seite verwehrt Welcompose nur
						den Zugang zu der Seite, nicht direkt zu den auf ihr
						dargestellten Informationen. Dies bedeutet, dass
						insbesondere Objekte aus dem Media Manager allen
						Besuchern frei zugänglich sind, sofern sie die URLs
						zu den Objekten kennen (was bedeutet, dass die
						Objekte beispielsweise von Google indiziert werden
						können). 
					</para>
				</listitem>
				<listitem>
					<para>
						Wenn Sie die Informationen einer geschützten Seite auf
						einer anderen Seite zugänglich machen, beispielsweise
						durch eigene Programmierung, werden die Informationen
						dort jedem Besucher angezeigt, ohne dass eine
						Authentifizierung verlangt wird.
					</para>
				</listitem>
			</itemizedlist>
		</sect2>
		
		<sect2 id="usage.protected_pages.protect_more_pages">
			<title>Weitere Seiten schützen</title>
					
			<para>
				Haben Sie bereits eine Seite geschützt und möchten nun weitere
				Seiten schützen, brauchen Sie nur einige Schritte der 
				Einrichtung (siehe <xref linkend="usage.protected_pages.setup"/>)
				zu wiederholen.
			</para>
			
			<itemizedlist>
				<listitem>
					<para>
						Soll eine weitere Seite denselben (oder weniger)
						Benutzergruppen zugänglich gemacht werden, reicht es,
						die jeweilige Seite zu schützen und der Seite
						dieselben (oder weniger) Benutzergruppen zuzuweisen.
						Sie brauchen eine neue Benutzergruppe nur anzulegen,
						wenn die Seite anderen Benutzern zugänglich gemacht
						werden soll.  
					</para>
				</listitem>
				<listitem>
					<para>
						Die Vorlage für das Login-Formular wird für alle
						geschützten Seiten verwendet. Das heisst, man muss
						nicht für jede geschützte Seite eine neue Vorlage
						für das Login-Formular anlegen. Dies ist nur nötig,
						wenn das Login-Formular einer bestimmten Seite
						anders gestaltet werden soll. Erstellen Sie zu diesem
						Zweck einen neuen Vorlagen-Satz, dem Sie die Seite
						und die neue Vorlage für das Login-Formular zuweisen.
					</para>
				</listitem>
			</itemizedlist>
		</sect2>
	</sect1>
	
</chapter>