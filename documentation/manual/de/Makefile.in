XSLTPROC=@XSLTPROC@
XMLLINT=@XMLLINT@
FOP=@FOP@

# Subdirs that contain docs
DOCS=appendix crash_course

XML_CATALOG_FILES=./build/docbook-xsl/catalog.xml
export XML_CATALOG_FILES

all: build/docbook-xsl entities.ent check manual.xml html

clean:
	-rm -rf html/
	-rm -rf pdf/

pdf: check entities.ent
	$(XSLTPROC) --output pdf/manual.fo ./build/fo.xsl manual.xml
	$(FOP) pdf/manual.fo pdf/manual.pdf | grep -v "\[ERROR\]"

entities.ent: ./build/mkentities.sh $(DOCS)
	./build/mkentities.sh $(DOCS) > .ent
	mv ".ent" "entities.ent"

html: html/index.html 

html/index.html: manual.xml build/html.xsl
	$(XSLTPROC) --output html/index.html ./build/html.xsl manual.xml

check: entities.ent
	$(XMLLINT) --valid --noout --postvalid manual.xml

build/docbook-xsl: build/docbook-xsl-1.69.1.tgz
	cd build && tar xzf docbook-xsl-1.69.1.tgz && touch docbook-xsl
