XSLTPROC=@XSLTPROC@
XMLLINT=@XMLLINT@
FOP=@FOP@

# Subdirs that contain docs
DOCS=appendix crash_course

XML_CATALOG_FILES=./build/docbook-xsl/catalog.xml
export XML_CATALOG_FILES

all: html-single-file pdf

clean:
	-rm -rf html/
	-rm -rf pdf/
	-rm -rf build/docbook-xsl

pdf: prepare-docbook-xsl entities.ent check
	$(XSLTPROC) --output pdf/manual.fo ./build/fo.xsl manual.xml
	$(FOP) pdf/manual.fo pdf/manual.pdf

html-single-file: prepare-docbook-xsl entities.ent check
	$(XSLTPROC) --output html/index.html ./build/html.xsl manual.xml

check: prepare-docbook-xsl entities.ent
	$(XMLLINT) --valid --noout --postvalid manual.xml

# Preparation macros

prepare-docbook-xsl:
	cd build && tar xfj `ls docbook*.bz2` && mv "`ls docbook*.bz2 | sed 's/\.tar\.bz2//'`" "docbook-xsl"

entities.ent:
	./build/mkentities.sh $(DOCS)
	./build/mkentities.sh $(DOCS) > .ent
	mv ".ent" "entities.ent"
